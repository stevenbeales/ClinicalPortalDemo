<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Clinical Portal Demo</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="Stylesheet" type="text/css" href="Resources/inforControlsCombined-1.3.css"
        media="all" />
    <script type="text/javascript" src="Resources/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="Resources/jquery-ui-1.8.14.custom.min.js"></script>
    <script type="text/javascript" src="Resources/inforControlsCombined-1.3.js"></script>
    <script type="text/javascript" src="Resources/inforTree.js"></script>
    
    <script type="text/javascript">

        var menuJson;

        $(function () {
            if (!checkUser()) {
                window.open("Login.html", "_self");
                return;
            }
            $(".inforSplitter").inforSplitter();
            $(".inforSplitBarVertical").remove();

            requestMenuJson();
            //buildMenuTree(menuJson);

//            $("#menu").inforTree({ "json_data": getMenuJson() })
//                                    .bind("select_node.jstree", function (e, data) {
//                                        var pageUrl = $.data(data.rslt.obj[0], "href");
//                                        loadPageAsyn(pageUrl);
//                                    });
        });

        function checkUser() {
            var userId = $.cookie("inforSignInDialog:userId");
            if (userId == null) {
                return false;
            }
            $("#userId").html(userId);
            return true;
        }

        function loadPage(url) {
            $("#content").load(url);
        }

        function loadPageAsyn(url) {
            $.ajax(
                { "type": "GET",
                    "url": url,
                    "success": function (msg) {
                        $("#content").html(msg);
                    }
                })
        }

        function requestMenuJson() {
            $.ajax({
                "async": false,
                "type": "POST",
                "url": "Service/Service1.asmx/GetMenu",
                "contentType": "application/json; charset=utf-8",
                "datatype": "json",
                "success": buildMenuTree
            });
//            $.getJson("Service/Service1.asmx/GetMenu", function (data, textStatus, jqXHR) {
//                menuJson = data;
//            });
        }

        function buildMenuTree(data) {
            $("#menu").inforTree({ "json_data": $.parseJSON(data.d) })
                    .bind("select_node.jstree", function (e, data) {
                        var pageUrl = $.data(data.rslt.obj[0], "href");
                        loadPageAsyn(pageUrl);
                    });
        }

        function CallHelloWorld() {
            $.ajax({
                "type": "POST",
                "url": "Service/Service1.asmx/HelloWorld",
                "contentType": "application/json; charset=utf-8",
                //"data": {},
                "datatype": "json",
                "success": function (msg) {
                    //alert(msg);
                    $("#content").html(msg.d);
                }
            });
        }

    </script>
</head>
<body>
    <div class="inforModuleContainer">
        <div id="header" class="inforModuleHeader">
            <div class="inforModuleHeaderLeft">
                <a id="logo" class="inforSplashScreen" href="http://www.infor.com/" target="_blank">
                    <img class="inforLogo" alt="infor logo" src="Resources/Images/topbanner_infor_120x28.png" />
                </a>
            </div>
            <div id="userInfo" class="inforModuleHeaderRight inforBannerText">
                <span>welcome: </span><a id="userId" style="color: White" href="#"></a>
            </div>
        </div>
        <div class="headerDivider">
        </div>
        <div id="body" class="inforModuleContentArea">
            <div class="inforSplitter">
                <div id="leftPane">
                    <div id="menu" class="inforTree">
                    </div>
                </div>
                <div id="rightPane">
                    <div id="content" class="inforSingleColumnLayout">
                        d</div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
